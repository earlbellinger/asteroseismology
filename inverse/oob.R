#### Plot random forest OOB score from learn.py 
#### Author: Earl Bellinger ( bellinger@mps.mpg.de ) 
#### Stellar Ages & Galactic Evolution Group 
#### Max-Planck-Institut fur Sonnensystemforschung 

library(magicaxis)
source(file.path('..', 'scripts', 'utils.R'))

data <- read.table(header=0, col.names=c("n_trees", "oob_estimate", "time"), 
    textConnection(
"2 -0.496870655721 0.7433867454528809
3 0.03266058846 0.7415869235992432
4 0.365609471523 0.8465867042541504
5 0.606090682364 0.7521426677703857
6 0.754574333957 0.8544738292694092
7 0.8407509872 0.758544921875
8 0.888732735925 0.8627321720123291
9 0.922578249246 0.7648825645446777
10 0.9481967702 0.7691912651062012
11 0.963857917542 0.7719712257385254
12 0.969161862042 0.7773425579071045
13 0.980509779633 0.7845332622528076
14 0.985986861829 0.7860658168792725
15 0.984419226109 0.9897623062133789
16 0.984621300209 0.8934907913208008
17 0.986872433469 0.7969098091125488
18 0.987165586372 0.9003660678863525
19 0.989367377962 1.0043907165527344
20 0.988693949234 1.217926263809204
21 0.988327103021 1.0139553546905518
22 0.989351909987 0.9234426021575928
23 0.989329386424 0.8208000659942627
24 0.989810940805 0.9236218929290771
25 0.989846517014 1.0620195865631104
26 0.990640828034 0.9286243915557861
27 0.99029254478 0.934838056564331
28 0.990578451078 0.9401402473449707
29 0.99020567886 0.9439818859100342
30 0.990378211919 1.0489017963409424
31 0.990736688828 0.9516615867614746
32 0.990647998135 1.059995412826538
33 0.991295863509 1.0589568614959717
34 0.990545002153 1.0590574741363525
35 0.991002383369 1.0654339790344238
36 0.991076347535 1.068476676940918
37 0.991066127219 1.071298599243164
38 0.991210543124 1.0799272060394287
39 0.99117462651 1.084069013595581
40 0.991461420455 1.0906295776367188
41 0.99093877378 1.1111485958099365
42 0.991630731193 1.0945394039154053
43 0.991803428475 1.0999956130981445
44 0.991683736357 1.1052966117858887
45 0.991718565876 1.1144325733184814
46 0.991803908964 1.1153061389923096
47 0.991860827157 1.220510721206665
48 0.991500970675 1.3234171867370605
49 0.991620076976 1.2283387184143066
50 0.991912270137 1.1309990882873535
51 0.991610091769 1.3318705558776855
52 0.991624825984 1.3584277629852295
53 0.991836587868 1.1657557487487793
54 0.99165096644 1.2467877864837646
55 0.992008668061 1.1613681316375732
56 0.991899762881 1.1538002490997314
57 0.991797616865 1.2525920867919922
58 0.992096799916 1.2590093612670898
59 0.991932560938 1.4652259349822998
60 0.992109826812 1.4706385135650635
61 0.992207277479 1.4837791919708252
62 0.992308933551 1.5855739116668701
63 0.991958354299 1.5812203884124756
64 0.992055593905 1.2846543788909912"))

data2 <- read.table(header=0, col.names=c("n_trees", "oob_estimate", "time"), 
    textConnection(
"2 -0.813026242024 0.6442315578460693
3 -0.153233096984 0.6443688869476318
4 0.29535318046 0.6451418399810791
5 0.520345058815 0.6514308452606201
6 0.693432540355 0.657595157623291
7 0.808931228105 0.6601150035858154
8 0.861826879667 0.8934426307678223
9 0.905647068745 0.664635419845581
10 0.93359218795 0.6899394989013672
11 0.956997730493 0.6717383861541748
12 0.971511006988 0.8755505084991455
13 0.973778270538 0.6792511940002441
14 0.979748753544 0.683621883392334
15 0.983997091106 0.7879486083984375
16 0.986645607988 0.6911239624023438
17 0.987708659057 0.6962263584136963
18 0.988890858186 0.6996402740478516
19 0.987670183745 0.9050955772399902
20 0.990444207237 0.8072786331176758
21 0.990385038402 0.914111852645874
22 0.990240288665 1.1180016994476318
23 0.99143133908 0.8195157051086426
24 0.991021892824 1.0240559577941895
25 0.991269362845 0.7284159660339355
26 0.991419798333 0.9324080944061279
27 0.991648592308 1.035951852798462
28 0.991981877583 0.7401223182678223
29 0.991978908618 0.8440802097320557
30 0.99215839 0.8499035835266113
31 0.991759220443 0.9524874687194824
32 0.99187518473 0.9550867080688477
33 0.991629709828 0.9600679874420166
34 0.991908247402 0.8627803325653076
35 0.99193609816 1.0684902667999268
36 0.992179642966 1.0031013488769531
37 0.992179664883 0.8772976398468018
38 0.992410170972 1.1797966957092285
39 0.992584217228 0.9829962253570557
40 0.992376744614 0.8871097564697266
41 0.992389421647 1.2858831882476807
42 0.992562177572 1.0009691715240479
43 0.992743581968 1.1032276153564453
44 0.992738182814 1.111548662185669
45 0.992579178949 1.0142738819122314
46 0.992596779122 1.2181262969970703
47 0.992752178682 1.2437305450439453
48 0.992726480449 0.9255571365356445
49 0.99288713749 1.0319945812225342
50 0.992640555633 1.027815580368042
51 0.992992108238 1.0391907691955566
52 0.992636919524 1.0424644947052002
53 0.992544823237 1.047170639038086
54 0.992939640665 1.0554959774017334
55 0.992976606404 1.0501658916473389
56 0.993052661896 1.2605679035186768
57 0.993088438216 1.0599720478057861
58 0.992831375194 1.0661885738372803
59 0.992884967928 1.2656371593475342
60 0.992904642331 1.2729856967926025
61 0.993141814483 1.07627534866333
62 0.993141950434 1.2838730812072754
63 0.993008505729 1.1964051723480225
64 0.993075711645 1.1895067691802979"))

oob_plot <- function(..., max_n=64, plotboth=0, text.cex=1, mgp=utils.mgp) {
    plot(data$n_trees, data$oob_estimate, axes=FALSE,
         xlab="Number of Decision Trees in Forest",
         ylab="Out-of-Bag Accuracy",
         xaxs='i', yaxs='i',
         ylim=c(0, 1), xlim=c(1, max_n), type='l', tcl=0)
    if (plotboth) lines(data2$n_trees, data2$oob_estimate, lty=2)
    abline(h=0.99, lty=3, col='darkred')
    abline(v=data$n_trees[min(which(data$oob_estimate>0.99))],
           lty=3, col='darkred')
    #lines(data3$n_trees, data3$oob_estimate, lty=3)
    axis(1, at=1:max_n, labels=FALSE, tcl=-0.125)
    axis(3, at=1:max_n, labels=FALSE, tcl=-0.125)
    axis(1, at=2^(0:log2(max_n)), labels=2^(0:log2(max_n)), tcl=-0.25,
        cex.axis=text.cex)
    axis(3, at=2^(0:log2(max_n)), labels=FALSE, tcl=-0.25)
    magaxis(side=c(2,4), tcl=-0.25, labels=c(1,0), mgp=mgp+c(0,0.25,0), 
        family=utils.font, las=2, cex.axis=text.cex)
    if (plotboth) {
        legend("bottomright", bty='n', lty=c(1,2,3), xjust=1, yjust=1,
               col=c("black", "black", "darkred"), cex=text.cex,
               legend=c("Fit using all observables",
                        expression("Fit without"~L*", "*log~g*", "*
                                   delta*nu[1*","*3]* ", or"~r[1*","*3]),
                        "99% Accuracy"))
    } else {
        legend("bottomright", bty='n', lty=3, col='darkred', 
            legend="99% Accuracy", xjust=1, yjust=1, cex=text.cex)
    }
}
oob_plot()

make_plots(oob_plot, "oob")
make_plots(oob_plot, "oob-without", plotboth=1)


